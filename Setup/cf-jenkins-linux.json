{
  "AWSTemplateFormatVersion" : "2010-09-09",

  "Description" : "cloud formation template for installing jenkins on linux",

  "Parameters" : {
    

    "KeyName": {
      "Description" : "Name of an existing EC2 KeyPair to enable SSH access to the instances",
      "Type": "AWS::EC2::KeyPair::KeyName",
      "ConstraintDescription" : "must be the name of an existing EC2 KeyPair.",
      "AllowedPattern" : ".+"
    }
  },

  "Resources" : {

    "EC2Instance" : {
        "Type" : "AWS::EC2::Instance",
        "Properties" : {
            "InstanceType" : "t2.micro",
            "SecurityGroups" : [ {"Ref" : "SecurityGroup"} ],
            "KeyName" : { "Ref" : "KeyName" },
            "ImageId" : "ami-00fcc917",
            "UserData"       : { "Fn::Base64" : { "Fn::Join" : ["", [
                "#!/bin/bash -xe\n",
                "sed -i 's|<useSecurity>true|<useSecurity>false|g' /opt/bitnami/apps/jenkins/jenkins_home/config.xml\n",
                "sudo /opt/bitnami/ctlscript.sh restart\n"

            ]]}}
        }
    },

    "SecurityGroup" : {
        "Type" : "AWS::EC2::SecurityGroup",
        "Properties" : {
          "GroupDescription" : "rules for opening the web and ssh ports",
          "SecurityGroupIngress" : [ {
            "IpProtocol" : "tcp",
            "FromPort" : "80",
            "ToPort" : "80",
            "CidrIp" : "0.0.0.0/0"
          },
          {
            "IpProtocol" : "tcp",
            "FromPort" : "22",
            "ToPort" : "22",
            "CidrIp" : "0.0.0.0/0"
          } ]
        }
      }

  },

  "Outputs" : {
    "JenkinsURL" : {
      "Description" : "URL for Jenkins",
      "Value" : { "Fn::Join" : ["", ["http://", { "Fn::GetAtt" : [ "EC2Instance", "PublicIp" ]} ]] }
    }
  }
}
